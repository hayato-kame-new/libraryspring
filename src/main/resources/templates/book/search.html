<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link th:href="@{/css/style.css}" rel="stylesheet"/>
<title th:text="|#{book_search_page.title} - library|"></title>
<!-- フラグメントを組み込む th:include の値は 読み込むファイルの.htmlを抜いたパス :: th:fragmentに指定した値 
パスは templatesからのパス -->
<style th:include="common/header :: common_header_style"></style>
</head>
<body> 
<!-- フラグメントの組み込み th:include の値は 読み込むファイルの.htmlを抜いたパス :: th:fragmentに指定した値 
パスは templatesからのパス-->
	<div th:include="common/header :: common_header"></div>
	 
	 <div class="contents">
		<h2 class="heading">書籍 検索ページ</h2>
		<h4>条件を指定して書籍情報を検索します</h4>
		
		<!-- 何も条件を指定しなかった場合にまた、リダイレクトしてこの画面が表示されますそのメッセージflashMsg -->
		<p th:if="${flashMsg != null}" th:text="${flashMsg}" ></p>
		
		<!-- バリデーションエラーのメッセージ -->
		<p th:if="${msg != null}" th:text="${msg}" ></p>
		
		<!--  曖昧検索です  ４つを AND検索で絞る  未入力でも検索できる 
		ただし、5つとも未入力なら検索しないで リダイレクトをして フォーム再表示する
		検索用のBookSearchForm フォームクラスを定義してるのでそれを利用する -->
		<div>
			<form th:action="@{/book_search}" method="post" th:object="${bookSearchForm}">
				<table>
				
					<tr><td style="width:13ch;"><label for="isbn">ISBN: </label></td>
						<td><input type="text" id="isbn" name="isbn" th:value="*{isbn}" th:errorclass="err"/>
							<div th:if="${#fields.hasErrors('isbn')}" th:errors="*{isbn}" th:errorclass="err"></div>
						</td>
					</tr>
					 
			 		<tr><td style="width:13ch;" ><label for="genre">ジャンル: </label></td>
			 			<td ><select id="genre" name="genre"  size="4" style="width:150px;">
					 		    <option value="" th:text="選択しない"></option>
					 		    <th:block th:each="element : ${genreMap}">
									<option  th:value="${element.value}"  th:selected="${element.value == bookSearchForm.genre}"   th:inline="text">[[${element.value}]]</option>
								</th:block>
					    	</select>
					    	<div th:if="${#fields.hasErrors('genre')}" th:errors="*{genre}" th:errorclass="err"></div>
				    	</td>
			    	</tr>
			    	
					<tr><td><label for="title">タイトルに含まれる文字: </label></td>
						<td>
							<input type="text" id="title" name="title" th:value="*{title}" th:errorclass="err" />
							<div th:if="${#fields.hasErrors('title')}" th:errors="*{title}" th:errorclass="err"></div>
						</td>
					</tr>
					
					<tr><td><label for="authors">著者に含まれる文字: </label></td> 
						<td>
							<input type="text" id="authors" name="authors" th:value="*{authors}" th:errorclass="err" />
							<div th:if="${#fields.hasErrors('authors')}" th:errors="*{authors}" th:errorclass="err"></div>
						</td>
					</tr>
					
					<tr><td><label for="publisher">出版社に含まれる文字: </label></td> 
						<td>
							<input type="text" id="publisher" name="publisher" th:value="*{publisher}" th:errorclass="err" />
							<div th:if="${#fields.hasErrors('publisher')}" th:errors="*{publisher}" th:errorclass="err"></div>
						</td>
					</tr>
					
					<tr><td></td><td><input style="margin-right: 20px;" type="submit" value="検索する" /> <input type="reset" value="キャンセル"></td></tr>
					
				</table>	
				
			</form>
		</div>
		
	
		<!-- 検索結果表示  その書籍が現在どういう状態かまで、わかるようにする つまり、貸出中なのかどうか-->
		<p th:if="${resultMsg}" th:text="${resultMsg}"></p>
		 <th:block th:if="${resultList != null && resultList.size() > 0}">
			 <table>
				<tr><th>ISBN</th><th>タイトル</th><th>著者名</th><th>書架状態</th><th></th><th></th><th></th></tr>
				
				<tr th:each="obj : ${resultList}" th:object="${obj}">	
					
					<td align="center" >
					
						<a href="/book_show" th:href="@{/book_show/{isbn}(isbn=${obj.isbn})}" th:text="${obj.isbn}"></a>
						<!-- フォームでHTTPメソッドGETで送ってもいい -->
					<!-- 	<form method = "get" action="/book_show" th:action = "@{/book_show/{isbn}(isbn=${obj.isbn})}" >
						 	<input type="hidden" name="isbn" th:value="${obj.isbn}" >
						 	<input type="submit" value="詳細" >
						 </form> -->
					</td>
					<td align="left" th:text="${obj.title}"></td>
					<td align="left" th:text="${obj.authors}"></td>
					
					<!-- 書架状態 表示後で変更 -->
					<td></td>
					<!-- <td align="center" th:text="${obj.orderDate}"></td> -->
					<!-- <td align="center" >
						<a  th:href="@{/order/{isbn}(isbn=${obj.isbn})}">●</a>
					</td>
					<td align="center">
						<a href="/delivery" th:href="@{/delivery/{isbn}(isbn=${obj.isbn})}">●</a>
					</td>-->
					<td align="center" > 
						
					</td>
					<td>
						<!-- フォームでHTTPメソッドGETで送ってもいい -->
						<form method = "get" action="/book_show" th:action = "@{/book_show/{isbn}(isbn=${obj.isbn})}" >
						 	<input type="hidden" name="isbn" th:value="${obj.isbn}" >
						 	<input type="submit" value="詳細" >
						 </form>
					</td>
					
					<!-- <td>
						 <form method = "get" action = "/emp_add_edit" >
						 	<input type="hidden" name="employeeId" th:value="${obj[0]}" >
						 	<input type="hidden" name="action" th:value="edit" >
						 	<input type="submit" value="編集" >
						 </form>		
					</td>
					<td>
						<form method = "post" action = "/emp_delete" >
							<input type="hidden" name="employeeId" th:value="${obj[0]}" >
							<input type="submit" value="削除" >
						</form>		
					</td> -->
				</tr> 
			</table>
		</th:block>
		<div >
			<a href="/" th:href="@{/}"><button type="button" th:text="トップページへ戻る" ></button></a>
		</div>
		
		<div>
			<form th:action="@{/logout}" method="post">
		        <input type="submit" value="ログアウト" />
		    </form>	
		</div>
	 </div>
</body>
</html>